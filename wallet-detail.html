<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TGCC Explorer - Wallet Detail</title>
    <meta name="description" content="" />
    <meta name="keywords" content="bitcoin, ethereum, monero, ico, token, free token, btc, eth" />
    <meta name="author" content="TGCC" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png" />

    <!-- Bootstrap & Plugins CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link href="assets/css/purple.css" rel="stylesheet" type="text/css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <link rel="stylesheet" href="assets/css/public.css">


</head>

<body>

    <div class="loading-wrapper">
        <div class="loading">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- ***** Header Area Start ***** -->
    <header class="header-area">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">
                            <!-- <img src="assets/images/logos/transparent-logo-purple.svg" class="light-logo" alt="SGU CHAIN"/>
							<img src="assets/images/logos/white-logo-purple.svg" class="dark-logo" alt="SGU CHAIN"/> -->
                            <img src="assets/images//logos/logo.png" class="light-logo" alt="TGCC CHAIN" />
                            <img src="assets/images/logos/logo.png" class="dark-logo" alt="TGCC CHAIN" />
                        </a>
                        <!-- ***** Logo End ***** -->

                        <!-- ***** Lang Start ***** -->
                        <div class="lang">
                            <div class="selected">
                                <img src="assets/images/flags/china.png" alt="">
                                <i class="fa fa-angle-down"></i>
                            </div>
                            <!-- <select class="trans-en">
								<option value="简体中文">简体中文</option>
								<option value="English">English</option>
							</select> -->

                            <ul class="flag-list trans-en">
                                <li class="chinese-language">
                                    <a href="#">
                                        <img src="assets/images/flags/china.png" alt="">
                                        <span>简体中文</span>
                                    </a>
                                </li>
                                <li class="english-language">
                                    <a href="#">
                                        <img src="assets/images/flags/en.png" alt="">
                                        <span>English</span>
                                    </a>
                                </li>
                            </ul>

                        </div>
                        <!-- ***** Lang End ***** -->

                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li>
                                <a href="index.html">
                                    <span i18n="i18n.themselves">首页</span>
                                </a>
                            </li>
                            <li>
                                <a href="wallet-list.html">
                                    <span i18n="i18n.successful-case">钱包</span>
                                </a>
                            </li>
                            <li>
                                <a href="wallet-list.html">
                                    <span i18n="i18n.Intelligence-test">交易</span>
                                </a>
                            </li>
                            <li>
                                <a href="wallet-list.html">
                                    <span i18n="i18n.evaluation">区块</span>
                                </a>
                            </li>
                        </ul>

                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <!-- ***** Wellcome Area Start 顶部导航***** -->
    <section class="block-explorer-wrapper bg-bottom-center" id="welcome-1">
        <div class="block-explorer text">
            <div class="container text-center">
                <div class="row">
                    <div class="col-lg-12 align-self-center">
                        <h1 i18n="i18n.Block browser">区块浏览器</h1>
                    </div>
                    <div class="offset-lg-3 col-lg-6">
                        <div style="display: flex;
                        justify-content: center;">
                            <p i18n="i18n.LatestBlockID">最新区块: </p><span class="latestBlockOfHead color-fff"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="search">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="input-wrapper">
                            <div class="input">
                                <input type="text" id="findContent" class="search-box" i18n="i18n.Please enter what you are looking for" placeholder="请输入您想查找的内容.">

                                <button class="search-btn">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- ***** Wellcome Area End ***** -->

    <section class="block-explorer-section section bg-bottom">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="center-heading">
                        <p class="section-title" i18n="i18n.WalletDetail">钱包详情</p>
                    </div>
                </div>
                <div class="offset-lg-3 col-lg-6">
                    <div class="center-text">
                        <!--                         <p>popular wallet</p>
 -->
                    </div>
                </div>
            </div>
            <div class="row m-bottom-70">
                <div class="col-lg-9 col-md-9 col-sm-12">
                    <div class="">
                        <table class="table table-striped table-responsive-stack table-latests table-detail">
                            <tbody id="addressInfo">
                                <tr>
                                    <td>
                                        <strong>名称</strong>
                                    </td>
                                    <td>--</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>地址</strong>
                                    </td>
                                    <td>--</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>公钥</strong>
                                    </td>
                                    <td>--</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>余额</strong>
                                    </td>
                                    <td>--</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-12" style="display: flex;justify-content: center;">
                    <div class="qr" id="qrcode">
                        <!-- <img src="assets/images/qr.svg" class="img-fluid d-block mx-auto" alt=""> -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- table Start -->
    <section class="block-explorer-section section pt-0 mt-0">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="center-heading">
                        <p class="section-title" i18n="i18n.AllTransactions">全部交易</p>
                    </div>
                </div>
                <div class="offset-lg-3 col-lg-6">
                    <div class="center-text">
                        <!--                         <p>Transaction details</p>
 -->
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="">
                        <table class="table table-striped table-latests table-responsive-stack alert-warning">
                            <thead>
                                <tr>
                                    <td i18n="ID">ID</td>
                                    <td i18n="i18n.timestamp">时间戳</td>
                                    <td i18n="i18n.dispatcher">发送者</td>
                                    <td i18n="i18n.receiver">接收者</td>
                                    <td i18n="i18n.amount">数量</td>
                                    <td i18n="i18n.service charge">手续费</td>
                                </tr>
                            </thead>
                            <tbody class="tbody-style" id="transactionDetails">
                                <tr>
                                    <td colspan="6">暂无数据</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



        </div>
    </section>
    <!-- table End -->

    <!-- 分页 -->
    <section class="block-explorer-section section p-0 m-0">
        <div class="container containerOne">
            <div id="pagination"></div>
        </div>
    </section>
    <!--  -->
    <!-- ***** Contact & Footer Start ***** -->
    <footer id="contact">
        <div class="footer-bottom slim">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <p class="copyright">2019 © by TGCC</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ***** Contact & Footer End ***** -->


    <!-- jQuery -->
    <script src="assets/js/jquery-2.1.0.min.js"></script>
    <!-- <script src="./assets/js/jquery.i18n.properties.min.js"></script> -->
    <!-- dbData -->
    <script src="assets/js/dbData.js"></script>


    <!-- Bootstrap -->
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/page.js"></script>


    <!-- Plugins -->
    <script src="assets/js/particles.min.js"></script>
    <script src="assets/js/scrollreveal.min.js"></script>
    <script src="assets/js/jquery.downCount.js"></script>
    <script src="assets/js/parallax.min.js"></script>

    <!-- Global Init -->
    <script src="assets/js/particle-purple.js"></script>
    <script src="assets/js/custom.js"></script>


    <!-- jquery.i18n.js -->

    <script src="assets/js/jquery.i18n.js"></script>


    <!-- QRcode.js -->
    <script src="assets//js/qrcode.js"></script>
    <script src="assets/layui/layui.all.js"></script>

    <script src="assets/js/clipboard.min.js"></script>


    <script src="assets/js/app.js"></script>

    <script>
        $(document).ready(function() {
            var BURL = 'http://124.70.148.13:4103/api/'

            var addressId = $.getUrlParam('id');
            if (!addressId) return;

            // 最新区链
            $.ajax({
                type: "GET",
                contentType: "application/json;charset=UTF-8",
                url: BURL + `v2/wallets/${addressId}`,
            }).
            done(res => {
                console.log(res.data);
                // var addressId = res.data.address;
                // console.log(addressId);
                var addressInfo = "";


                addressInfo = `
                <tr>
                                    <td>
                                        <strong i18n="i18n.Name">名称</strong>
                                    </td>
                                    <td> ${getAddressUsername2(res.data.address)}</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong i18n="i18n.Address">地址</strong>
                                    </td>
                                    <td class="ren-QRcode">${res.data.address}  <button type="button" class="btn btn-secondary btn-small copy-button" aria-label="${res.data.address}"> <span i18n="i18n.copy">复制</span></button></td>

                                </tr>
                                <tr>
                                    <td>
                                        <strong i18n="i18n.PublicKey">公钥</strong>
                                    </td>
                                    <td style="height:70px;">${res.data.publicKey}  <button type="button" class="btn btn-secondary btn-small copy-button" aria-label="${res.data.publicKey}"> <span i18n="i18n.copy">复制</span></button></td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong i18n="i18n.balance">余额</strong>
                                    </td>
                                    <td>${(res.data.balance/ 100000000).toFixed(1)}T</td>
                                </tr>
                `

                $("#addressInfo").html(addressInfo); //这是上面的个人信息表格和二位码

                $.refreshLang();

                var QRcoer = "";
                var qrcode = new QRCode("qrcode");

                function makeCode() {
                    qrcode.makeCode(res.data.address);
                }
                makeCode();




                // $.ajax({
                //     type: "GET",
                //     contentType: "application/json;charset=UTF-8",
                //     url: BURL+`v2/wallets/${addressId}/transactions?orderBy=timestamp:desc&limit=10`,
                // }).
                // done(res1=>{
                //     console.log(res1.data);
                //     var arrTransactionDatails = res1.data;
                //     console.log(arrTransactionDatails)
                //     let transactionDetails="";
                //     arrTransactionDatails.forEach(element => {
                //         console.log(element.length);
                //         transactionDetails += `
                //                     <tr>
                //                         <td>${element.id}</td>
                //                         <td>${element.timestamp.human.slice(0,9)} ${element.timestamp.human.slice(11,16)}</td>
                //                         <td>${element.sender}</td>
                //                         <td>${element.recipient}</td>
                //                         <td>${element.amount}</td>
                //                         <td>${element.fee}</td>
                //                     </tr>

                //     `
                //     });


                //     $("#transactionDetails").html(transactionDetails); 


                // }).fail(err=>{

                // })
            }).
            fail(err => {
                console.log(err);
            });



            const render = function(data) {
                console.log(data)
                let ThewalletLevel = data;
                let transactionDetails = "";
                ThewalletLevel.forEach(element => {
                    function p(s) {
                        return s < 10 ? '0' + s : s
                    }
                    var d = new Date(element.timestamp.human)
                    var datetime = d.getFullYear() + '-' + p((d.getMonth() + 1)) + '-' + p(d.getDate()) + ' ' + p(d.getHours()) + ':' + p(d.getMinutes()) + ':' + p(d.getSeconds());
                    console.log(element.length);
                    transactionDetails += `
                                <tr>
                                    <td><a href="transaction-detail.html?id=${element.id}">${element.id.slice(0,16)}...</a></td>
                                    <td>${datetime}</td>
                                    <td><a href="wallet-detail.html?id=${element.sender}">${getAddressUsername(element.sender)}</a></td>
                                    <td><a href="wallet-detail.html?id=${element.recipient}">${getAddressUsername(element.recipient)}</a></td>
                                    <td class="differ-number-style"><span>${element.amount / Math.pow(10, 8).toFixed(2)}</span>T</td>
                                    <td>${element.fee / Math.pow(10, 8).toFixed(2)}T</td>
                                </tr>
                               
                `
                });


                $("#transactionDetails").html(transactionDetails);

                console.log($(".differ-number-style > span").text());
                var differNumberStyleArr = $(".differ-number-style > span").text();

                if (differNumberStyleArr < 0) {
                    $(".differ-number-style").css("color", "red");
                } else if (differNumberStyleArr > 0) {
                    $(".differ-number-style").css("color", "green");
                }
            }

            const initPagenation = function(pageCount) {
                $('#pagination').pagination({
                    pages: pageCount,
                    edges: 2,
                    prevText: $.getLang() == 'en' ? "Prev" : "上一页",
                    nextText: $.getLang() == "en" ? "Next" : "下一页",
                    cssStyle: 'pagination-sm',
                    displayedPages: 5,
                    onPageClick: function(pageNumber, event) {
                        //点击时调用
                        console.log(pageNumber);

                        // console.log(event);
                        if (pageNumber == 1) {
                            $(".prev").attr("disabled", "disabled");
                        }
                        if (pageNumber == pageCount) {
                            $(".next").attr("disabled", "disabled");
                        }
                        $.ajax({
                            type: "GET",
                            url: BURL + `v2/wallets/${addressId}/transactions?orderBy=timestamp:desc&limit=10&page=${pageNumber + 1}`,
                            success(res) {
                                console.log(res);
                                render(res.data)
                            }
                        })
                    },
                    onInit: function(getid) {
                        //刷新时调用
                        console.log(getid);
                    }

                });
            }

            $.ajax({
                //请求方式
                type: "GET",
                //请求的媒体类型
                contentType: "application/json;charset=UTF-8",
                url: BURL + `v2/wallets/${addressId}/transactions?orderBy=timestamp:desc&limit=10`,
                //请求成功
                success: function(res) {
                    render(res.data)
                    console.log('hahsahsd');
                    console.log(res.data);

                    initPagenation(res.meta.pageCount);
                }

            })

        });
    </script>

    <script>
    </script>


</body>

</html>